---
title: Docker入门
date: 2021-4-5
---

### 虚拟机与容器  

1. 虚拟机： 虚拟化硬件，虚拟机英文全称Virtual Machine 指通过软件模拟的具有完整硬件系统功能的、运行在一个完全隔离环境中的完整计算机系统。在实体计算机中能够完成的工作在虚拟机中都能够实现。  
在计算机中创建虚拟机时，需要将实体机的部分硬件和内存容量作为虚拟机的硬盘和内存容量。每个虚拟机都有独立的CMOS、硬盘和操作系统，可以像使用实体机一样对虚拟机进行操作。  

虚拟机技术的代表是```VMWare``` 和 ```OpenStack``` 

2. 容器:将操作系统虚拟化，是一个标准的软件单元。  

   + Run everywhere：容器可以将代码与配置文件和相关的依赖库进行打包，从而确保在任何环境下的运行都是一致的。  

   + 高资源利用率： 容器提供进程级别的隔离，因此可以更加精细地设置CPU和内存的使用率


   + 快速扩展：每个容器都可以作为单独的进程予以运行，并且可以共享底层操作系统的系统资源，这样一来可以加快容器的启动和停止效率。  


3. 区别与联系

    + 虚拟机可以隔离出很多“字电脑”，但是占用空间很大，启动很慢。
    + 容器技术不需要模拟出整个操作系统，只需要虚拟出一个小规模的环境。
    + 运行空间，虚拟机一般要几G到几十G的空间，而容器只要MB级别


对比表格

|特性|虚拟机|容器|
|:---:|:---:|:---:|
|隔离级别|操作系统级别|进程|
|隔离策略|Hypervisor|Cgroups|
|系统资源|5~15%|0~5%|
|启动时间|分钟级|秒级|
|镜像存储|GB-TB|KB-MB|
|集群规模|上百|上万|
|高可用策略|备份、容灾、迁移|弹性、负载、动态|  




与虚拟机相比，容器更轻量且速度更快，因为它利用了 Linux 底层操作系统在隔离的环境中运行。虚拟机的 Hypervisor 创建了一个非常牢固的边界，以防止应用程序突破它，而容器的边界不那么强大。

物理机部署不能充分利用资源，造成资源浪费。虚拟机方式部署，虚拟机本身会占用大量资源，导致资源浪费，另外虚拟机性能也很差。而容器化部署比较灵活，且轻量级，性能较好。

虚拟机属于虚拟化技术，而 Docker 这样的容器技术，属于轻量级的虚拟化。    


<br>
<br>
<br>

### Docker常用的11个命令

|命令|描述|
|:---:|:---:|
|FROM|基于哪个镜像来实现|
|MAINTAINER|镜像创建者|
|ENV|声明环境变量|
|RUN|执行命令|
|ADD|添加宿主机文件到容器里，有需要解压的文件会自动解压|
|COPY|添加宿主机文件到容器里|
|WORKDIR|工作目录|
|EXPOSE|容器内应用可使用的端口|
|CMD|容器启动后所执行的程序，如果执行docker run后面跟启动命令会被覆盖掉|
|ENTRYPOINT|与CMD功能相同，但docker run不会覆盖，如果需要覆盖可以增加参数 -entrypoint来覆盖|
|VOLUME|数据卷，将宿主机的目录映射到容器内的目录|

### 常见命令  

从仓库上拉取最新镜像
```shell
docker pull [IMAGE:tag]
```

搜索远端仓库中共享的镜像，支持的参数有：  
+ --automated=false 仅显示自动创建的镜像  
+ --no-trunc=false  输出信息不截断显示  
+ -s, --stars=0指定仅显示评价为指定星级以上的镜像

```shell
docker search [IMAGE]
```

```shell script
docker images 
# 
docker ps 
# 
docker inspect 
```

在启动容器时，可以通过-P或者-p来指定端口映射, 使用-P时Docker会随机映射一个49000~49900的端口至容器内部开放的网络端口   


用--link来连接容器，允许一个容器访问另一个容器的信息，在两个容器之间创建了一个安全隧道  
启动被连接容器时不需要开放端口(不用-p或者-P标记)，从而避免了暴露数据库或者其他应用端口   




